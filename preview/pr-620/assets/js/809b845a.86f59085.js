"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[3232],{28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var t=r(96540);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}},49235:(e,n,r)=>{r.d(n,{A:()=>s});r(96540);var t=r(74848);function s(e){return(0,t.jsxs)("div",{children:[e.python_package_name&&e.python_package_version&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/engineers/package-hub/",children:(0,t.jsxs)("span",{className:"badge-dependency",children:[(0,t.jsx)("span",{className:"left",children:e.python_package_name}),(0,t.jsx)("span",{className:"right",children:e.python_package_version})]})}),e.scala_package_name&&e.scala_package_version&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/engineers/package-hub",children:(0,t.jsxs)("span",{className:"badge-dependency",children:[(0,t.jsx)("span",{className:"left",children:e.scala_package_name}),(0,t.jsx)("span",{className:"right",children:e.scala_package_version})]})}),e.python_lib&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/extensibility/dependencies/prophecy-libraries",children:(0,t.jsxs)("span",{className:"badge-dependency",children:[(0,t.jsx)("span",{className:"left",children:"ProphecyLibsPython"}),(0,t.jsx)("span",{className:"right",children:e.python_lib})]})}),e.scala_lib&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/extensibility/dependencies/prophecy-libraries",children:(0,t.jsxs)("span",{className:"badge-dependency",children:[(0,t.jsx)("span",{className:"left",children:"ProphecyLibsScala"}),(0,t.jsx)("span",{className:"right",children:e.scala_lib})]})}),e.uc_single&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/Spark-fabrics/databricks/",children:(0,t.jsxs)("span",{className:"badge-spark",children:[(0,t.jsx)("span",{className:"left",children:"Databricks UC Single Cluster"}),(0,t.jsx)("span",{className:"right",children:e.uc_single})]})}),e.uc_shared&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/Spark-fabrics/databricks/ucshared",children:(0,t.jsxs)("span",{className:"badge-spark",children:[(0,t.jsx)("span",{className:"left",children:"Databricks UC Shared"}),(0,t.jsx)("span",{className:"right",children:e.uc_shared})]})}),e.livy&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/Spark-fabrics/livy",children:(0,t.jsxs)("span",{className:"badge-spark",children:[(0,t.jsx)("span",{className:"left",children:"Livy"}),(0,t.jsx)("span",{className:"right",children:e.livy})]})}),(0,t.jsx)("br",{}),(0,t.jsx)("br",{})]})}},52584:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"Spark/gems/transform/unpivot","title":"Unpivot","description":"Use the Unpivot gem to transform your data from a wide format to a long format","source":"@site/docs/Spark/gems/transform/unpivot.md","sourceDirName":"Spark/gems/transform","slug":"/engineers/unpivot","permalink":"/prophecy-docs-staging/preview/pr-620/engineers/unpivot","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"gems","permalink":"/prophecy-docs-staging/preview/pr-620/tags/gems"},{"inline":true,"label":"unpivot","permalink":"/prophecy-docs-staging/preview/pr-620/tags/unpivot"},{"inline":true,"label":"wideformat","permalink":"/prophecy-docs-staging/preview/pr-620/tags/wideformat"},{"inline":true,"label":"longformat","permalink":"/prophecy-docs-staging/preview/pr-620/tags/longformat"}],"version":"current","frontMatter":{"title":"Unpivot","id":"unpivot","slug":"/engineers/unpivot","description":"Use the Unpivot gem to transform your data from a wide format to a long format","tags":["gems","unpivot","wideformat","longformat"]},"sidebar":"mySidebar","previous":{"title":"SetOperation","permalink":"/prophecy-docs-staging/preview/pr-620/engineers/set-operation"},"next":{"title":"WindowFunction","permalink":"/prophecy-docs-staging/preview/pr-620/engineers/window-function"}}');var s=r(74848),a=r(28453),i=r(49235),l=r(65537),o=r(79329);const c={title:"Unpivot",id:"unpivot",slug:"/engineers/unpivot",description:"Use the Unpivot gem to transform your data from a wide format to a long format",tags:["gems","unpivot","wideformat","longformat"]},d=void 0,h={},u=[{value:"Parameters",id:"parameters",level:2},{value:"Example",id:"example",level:2},{value:"Example code",id:"example-code",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{python_package_name:"ProphecySparkBasicsPython",python_package_version:"0.2.36+",scala_package_name:"",scala_package_version:"",scala_lib:"",python_lib:"",uc_single:"14.3+",uc_shared:"14.3+",livy:"Not Supported"}),"\n",(0,s.jsx)(n.p,{children:"Use the Unpivot gem to transform your data from a wide format to a long format."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["If you want to pivot the data, rather than unpivot, use the ",(0,s.jsx)(n.a,{href:"/engineers/aggregate",children:"Aggregate"})," gem."]})}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Column(s) to use as identifiers"}),(0,s.jsx)(n.td,{children:"The column(s) that will identify to which group or entity the observation corresponds to."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Columns to unpivot"}),(0,s.jsx)(n.td,{children:"The columns (wide format) that you would like to transform into a single column (long format)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Variable column name"}),(0,s.jsx)(n.td,{children:"The name of the column that contains the names of the unpivoted columns. This helps describe the values in the value column."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Value column name"}),(0,s.jsx)(n.td,{children:"The name of the column that will contain the values from the unpivoted columns."})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,s.jsx)(n.p,{children:"Imagine you have sales data for different products, with each quarter's sales stored in its own column\u2014this is known as wide format. Before modeling seasonal trends or doing time series analysis, it's often helpful to convert this into long format, where each row represents a single observation."}),"\n",(0,s.jsx)("div",{class:"table-example",children:(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Product"}),(0,s.jsx)(n.th,{children:"Q1"}),(0,s.jsx)(n.th,{children:"Q2"}),(0,s.jsx)(n.th,{children:"Q3"}),(0,s.jsx)(n.th,{children:"Q4"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"100"}),(0,s.jsx)(n.td,{children:"150"}),(0,s.jsx)(n.td,{children:"130"}),(0,s.jsx)(n.td,{children:"170"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"90"}),(0,s.jsx)(n.td,{children:"120"}),(0,s.jsx)(n.td,{children:"110"}),(0,s.jsx)(n.td,{children:"160"})]})]})]})}),"\n",(0,s.jsx)(n.p,{children:"To configure a Unpivot gem for this table:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Select the identifier columns. In the example above, the ",(0,s.jsx)(n.code,{children:"Product"})," column is the identifier column."]}),"\n",(0,s.jsxs)(n.li,{children:["Select the columns to unpivot. In the example above, all of the quarter columns (",(0,s.jsx)(n.code,{children:"Q1"}),", ",(0,s.jsx)(n.code,{children:"Q2"}),", etc.) are your columns to unpivot."]}),"\n",(0,s.jsxs)(n.li,{children:["Name the variable column ",(0,s.jsx)(n.code,{children:"Quarter"})," because it identifies the sales period."]}),"\n",(0,s.jsxs)(n.li,{children:["Name the value column ",(0,s.jsx)(n.code,{children:"UnitsSold"})," because it contains number of units sold per quarter."]}),"\n",(0,s.jsx)(n.li,{children:"Save and run the gem."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"After the transformation:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The quarter names (",(0,s.jsx)(n.code,{children:"Q1"}),", ",(0,s.jsx)(n.code,{children:"Q2"}),", etc.) will move into a new ",(0,s.jsx)(n.code,{children:"Quarter"})," column."]}),"\n",(0,s.jsxs)(n.li,{children:["The corresponding sales values will be stored in a ",(0,s.jsx)(n.code,{children:"UnitsSold"})," column."]}),"\n"]}),"\n",(0,s.jsx)("div",{class:"table-example",children:(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Product"}),(0,s.jsx)(n.th,{children:"Quarter"}),(0,s.jsx)(n.th,{children:"UnitsSold"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Q1"}),(0,s.jsx)(n.td,{children:"100"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Q2"}),(0,s.jsx)(n.td,{children:"150"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Q3"}),(0,s.jsx)(n.td,{children:"130"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Q4"}),(0,s.jsx)(n.td,{children:"170"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Q1"}),(0,s.jsx)(n.td,{children:"90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Q2"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Q3"}),(0,s.jsx)(n.td,{children:"110"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Q4"}),(0,s.jsx)(n.td,{children:"160"})]})]})]})}),"\n",(0,s.jsx)(n.p,{children:"This makes your data easier to analyze over time, since each row now represents one product's sales for a specific quarter."}),"\n",(0,s.jsx)(n.h2,{id:"example-code",children:"Example code"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["To see the compiled code of your project, ",(0,s.jsx)(n.a,{href:"/engineers/pipelines#project-editor",children:"switch to the Code view"})," in the project header."]})}),"\n","\n",(0,s.jsx)(l.A,{children:(0,s.jsx)(o.A,{value:"py",label:"Python",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:'def unpivot_products_by_quarter(spark: SparkSession, in0: DataFrame) -> DataFrame:\n    return in0.unpivot(["Product"], [col for col in in0.columns if col not in ["Product"]], "Quarter", "UnitsSold")\n'})})})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},65537:(e,n,r)=>{r.d(n,{A:()=>w});var t=r(96540),s=r(18215),a=r(65627),i=r(56347),l=r(50372),o=r(30604),c=r(11861),d=r(78749);function h(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:s}}=e;return{value:n,label:r,attributes:t,default:s}}))}(r);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function p(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const s=(0,i.W6)(),a=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,o.aZ)(a),(0,t.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(s.location.search);n.set(a,e),s.replace({...s.location,search:n.toString()})}),[a,s])]}function x(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,a=u(e),[i,o]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[c,h]=m({queryString:r,groupId:s}),[x,j]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,a]=(0,d.Dv)(r);return[s,(0,t.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:s}),f=(()=>{const e=c??x;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{f&&o(f)}),[f]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),h(e),j(e)}),[h,j,a]),tabValues:a}}var j=r(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=r(74848);function b(e){let{className:n,block:r,selectedValue:t,selectValue:i,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,r=o.indexOf(n),s=l[r].value;s!==t&&(c(n),i(s))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:l.map((e=>{let{value:n,label:r,attributes:a}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{o.push(e)},onKeyDown:h,onClick:d,...a,className:(0,s.A)("tabs__item",f.tabItem,a?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function v(e){let{lazy:n,children:r,selectedValue:a}=e;const i=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function y(e){const n=x(e);return(0,g.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,g.jsx)(b,{...n,...e}),(0,g.jsx)(v,{...n,...e})]})}function w(e){const n=(0,j.A)();return(0,g.jsx)(y,{...e,children:h(e.children)},String(n))}},79329:(e,n,r)=>{r.d(n,{A:()=>i});r(96540);var t=r(18215);const s={tabItem:"tabItem_Ymn6"};var a=r(74848);function i(e){let{children:n,hidden:r,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,i),hidden:r,children:n})}}}]);