"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[99935],{28453:(e,r,s)=>{s.d(r,{R:()=>o,x:()=>a});var i=s(96540);const n={},l=i.createContext(n);function o(e){const r=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),i.createElement(l.Provider,{value:r},e.children)}},34188:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"administration/fabrics/Spark-fabrics/databricks/volumes-plibs","title":"Set up Prophecy libraries in Databricks volumes","description":"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks","source":"@site/docs/administration/fabrics/Spark-fabrics/databricks/volumns-plibs.md","sourceDirName":"administration/fabrics/Spark-fabrics/databricks","slug":"/engineers/dbx-volumes-plibs","permalink":"/prophecy-docs-staging/preview/pr-618/engineers/dbx-volumes-plibs","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"unity catalog","permalink":"/prophecy-docs-staging/preview/pr-618/tags/unity-catalog"},{"inline":true,"label":"databricks","permalink":"/prophecy-docs-staging/preview/pr-618/tags/databricks"},{"inline":true,"label":"plibs","permalink":"/prophecy-docs-staging/preview/pr-618/tags/plibs"}],"version":"current","frontMatter":{"title":"Set up Prophecy libraries in Databricks volumes","sidebar_label":"ProphecyLibs in volumes","id":"volumes-plibs","slug":"/engineers/dbx-volumes-plibs","description":"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks","tags":["unity catalog","databricks","plibs"]},"sidebar":"adminSidebar","previous":{"title":"Allowlist ProphecyLibs","permalink":"/prophecy-docs-staging/preview/pr-618/engineers/dbx-whitelist-plibs"},"next":{"title":"Prophecy-managed","permalink":"/prophecy-docs-staging/preview/pr-618/engineers/prophecy-managed-fabric"}}');var n=s(74848),l=s(28453);const o={title:"Set up Prophecy libraries in Databricks volumes",sidebar_label:"ProphecyLibs in volumes",id:"volumes-plibs",slug:"/engineers/dbx-volumes-plibs",description:"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks",tags:["unity catalog","databricks","plibs"]},a=void 0,t={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Prepare a Databricks volume",id:"prepare-a-databricks-volume",level:2},{value:"Upload Prophecy libraries",id:"upload-prophecy-libraries",level:2},{value:"Update fabric configuration",id:"update-fabric-configuration",level:2},{value:"Whitelist for UC standard clusters",id:"whitelist-for-uc-standard-clusters",level:2}];function p(e){const r={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.p,{children:"If Maven or PyPI is blocked in your Databricks environment, you can add Prophecy libraries directly to Databricks volumes."}),"\n",(0,n.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsx)(r.p,{children:"Before you set up Prophecy libraries in a Databricks volume, you need to know which library version your project uses. That version must be present in the volume for the setup to work."}),"\n",(0,n.jsx)(r.p,{children:"To check your project\u2019s Prophecy library version:"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Open your project metadata."}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Click on the ",(0,n.jsx)(r.strong,{children:"Dependencies"})," tab."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Find the relevant Prophecy library (Scala or Python) and note the version."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"prepare-a-databricks-volume",children:"Prepare a Databricks volume"}),"\n",(0,n.jsx)(r.p,{children:"To get started, you'll need to define a Databricks volume where you will store the Prophecy libraries."}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Create a volume in your workspace where you'll maintain Prophecy libraries:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"databricks volumes create --name prophecy-libs --storage-location <your-volume-location>\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Download ",(0,n.jsx)(r.a,{href:"https://pypi.org/project/pyhocon/",children:"pyhocon"})," from PyPI or an internal artifactory."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Upload the dependency to the volumes path."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"databricks fs cp pyhocon-0.3.61-py3-none-any.whl dbfs:/volumes/prophecy-libs/\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Create a local Init Script. For example, create ",(0,n.jsx)(r.code,{children:"install_pyhocon.sh"})," with the following content:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"#!/bin/bash\npip install /Volumes/<catalog>/<schema>/prophecy-libs/pyhocon-0.3.61-py3-none-any.whl\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Upload the script to your volumes path."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"databricks fs cp install_pyhocon.sh dbfs:/volumes/prophecy-libs/\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"upload-prophecy-libraries",children:"Upload Prophecy libraries"}),"\n",(0,n.jsx)(r.p,{children:"Download the appropriate Prophecy library versions from the public buckets and upload them to the same volume path. Replace version in the example URLs based on what's used in your Prophecy project."}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"ProphecyPythonLibs"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"wget https://prophecy-public-bucket.s3.us-east-2.amazonaws.com/python-prophecy-libs/prophecy_libs-1.9.45-py3-none-any.whl\n\ndatabricks fs cp prophecy_libs-1.9.45-py3-none-any.whl dbfs:/volumes/prophecy-libs/\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"ProphecyScalaLibs"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"wget https://prophecy-public-bucket.s3.us-east-2.amazonaws.com/prophecy-libs/prophecy-libs-assembly-3.5.0-8.9.0.jar\n\ndatabricks fs cp prophecy-libs-assembly-3.5.0-8.9.0.jar dbfs:/volumes/prophecy-libs/\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["You can also download Prophecy libraries from Azure and GCP. For a full list of paths, visit ",(0,n.jsx)(r.a,{href:"/engineers/prophecy-libraries",children:"Prophecy libraries"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"update-fabric-configuration",children:"Update fabric configuration"}),"\n",(0,n.jsx)(r.p,{children:"For all relevant Databricks fabrics, you'll need to update the location of the Prophecy libraries."}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Open the fabric settings."}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Toward the end of the page, fsind the ",(0,n.jsx)(r.strong,{children:"Prophecy Library"})," settings."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["For Scala and/or Python, change the ",(0,n.jsx)(r.strong,{children:"Resolution mode"})," to ",(0,n.jsx)(r.strong,{children:"File System"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Under ",(0,n.jsx)(r.strong,{children:"Path"}),", add your volume path that you created earlier."]}),"\n",(0,n.jsxs)(r.p,{children:["Example: ",(0,n.jsx)(r.code,{children:"dbfs:/volumes/prophecy-libs/"})]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Click ",(0,n.jsx)(r.strong,{children:"Update"})," to save this change."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"whitelist-for-uc-standard-clusters",children:"Whitelist for UC standard clusters"}),"\n",(0,n.jsxs)(r.p,{children:["To whitelist the Init Script and the JAR path, follow the instructions to ",(0,n.jsx)(r.a,{href:"/engineers/dbx-whitelist-plibs",children:"add Prophecy libraries to your Databricks allowlist"}),"."]})]})}function d(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}}}]);